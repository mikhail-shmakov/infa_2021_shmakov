Написал везде коментарии, чтобы было понятно. Сделал вывод графа в dot файл. Этот файл можно загрузить в http://www.webgraphviz.com/ и получить картинку. Картинки прикрепил в папке. Много того, что указано в качестве обязательного синтаксиса, Visual Studio просто исправляет обратно, но я всё исправил по максимуму.